# 1588. Сумма Всех Подмассивов Нечетной Длины

**Условие**

Дан массив положительных целых чисел `arr`, вычислить сумму всех возможных подмассивов нечетной длины.

Подмассив — это непрерывная подпоследовательность массива.

Возвращает сумму всех подмассивов нечетной длины массива `arr`.

**Ограничения**

- `1 <= arr.length <= 100`
- `1 <= arr[i] <= 1000`

**Примеры**
```
Example 1:

Input: arr = [1,4,2,5,3]
Output: 58
Explanation: The odd-length subarrays of arr and their sums are:
[1] = 1
[4] = 4
[2] = 2
[5] = 5
[3] = 3
[1,4,2] = 7
[4,2,5] = 11
[2,5,3] = 10
[1,4,2,5,3] = 15
If we add all these together we get 1 + 4 + 2 + 5 + 3 + 7 + 11 + 10 + 15 = 58

Example 2:

Input: arr = [1,2]
Output: 3
Explanation: There are only 2 subarrays of odd length, [1] and [2]. Their sum is 3.

Example 3:

Input: arr = [10,11,12]
Output: 66
```


**Решение**
1. Вроде и не брут-форс, но получается 3 вложенных цикла, считаем массив-маску, который позволяет понять, сколько раз какое число входит в массив.

```C++
class Solution {
public:
    int sumOddLengthSubarrays(vector<int>& arr) {
        int sum = 0;
        int maxOddLength = (arr.size() % 2 == 1)? arr.size() : arr.size()-1;
        int* mask = new int[arr.size()] {};

        int step = 1;
        while (step <= maxOddLength)  {
            for (int i = 0; i < arr.size(); ++i) {
                if ((i+step) <= arr.size()) {
                    for (int j = 0; j < step; ++j) mask[i+j] += 1;
                }
            }
            step+=2;
        }

        for (int i = 0; i < arr.size(); ++i) sum += mask[i]*arr[i];

        return sum; 
    }
};
```

2. Если рассматривать более общий случай - сумму всех подмассивов, то можно заметить, что если дан, скажем, массив `[1, 2, 3, 4]`, то подмассивы:
- `[1], [2], [3], [4]`
- `[1, 2], [2, 3], [3, 4]`
- `[1, 2, 3], [2, 3, 4]`
- `[1, 2, 3, 4]`

Первый элемент входит в сумму 4 раза, второй - 6 раз, третий - 6, четвертый - 4. 

Выражая формулой: `i-й` элемент начинает `(n - i)` подмассивов и входит в `(n - i)` подмассивов каждого предыдущего элемента, а предыдущих элементов - `i`. Таким образом, каждый элемент входит в сумму `(n - i) + i * (n - i)  = (n - i) * (i + 1)` раз.

Однако эта формула верна для подмассивов любой длины, для подмассивов нечетной длины будет верно: `((n - i) * (i + 1) + 1) / 2` раз. Эту формулу и используем.

```C++
class Solution {
public:
    int sumOddLengthSubarrays(vector<int>& arr) {
        int sum = 0, n = arr.size();

        for (int i = 0; i < n; ++i) sum += arr[i] * (((n-i)*(i+1)+1) / 2);

        return sum; 
    }
};
```
